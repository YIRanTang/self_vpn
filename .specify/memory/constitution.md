<!--
Sync Impact Report:
- Version change: N/A (template) → 1.0.0 (initial)
- Added principles:
  - I. 代码质量优先
  - II. 测试驱动开发
  - III. 用户体验一致性
  - IV. 性能优先设计
- Added sections:
  - 技术约束
  - 开发工作流
  - 治理规则
- Templates requiring updates:
  - ✅ plan-template.md (Constitution Check 部分需在使用时填入)
  - ✅ spec-template.md (已兼容)
  - ✅ tasks-template.md (已兼容)
- Follow-up TODOs: None
-->

# Self VPN 项目宪法

## 核心原则

### I. 代码质量优先

所有代码必须遵循以下质量标准：

- **可读性**: 代码必须自解释，变量和函数命名必须清晰表达意图
- **一致性**: 全项目必须使用统一的代码风格（使用 linter 和 formatter 强制执行）
- **模块化**: 单个函数/方法不得超过 50 行；单个文件不得超过 500 行
- **DRY 原则**: 重复代码超过 3 次必须抽象为可复用组件
- **文档化**: 公开 API 必须有文档字符串；复杂逻辑必须有注释说明「为什么」
- **错误处理**: 所有外部输入必须验证；错误必须有明确的上下文信息

### II. 测试驱动开发

测试是代码质量的保障，必须遵循以下标准：

- **覆盖率要求**: 核心业务逻辑覆盖率必须 ≥ 80%；关键路径覆盖率必须 100%
- **测试金字塔**: 优先单元测试 > 集成测试 > 端到端测试
- **测试命名**: 测试名必须描述「场景 + 预期结果」（如 `test_login_with_invalid_password_returns_401`）
- **隔离性**: 每个测试必须独立运行，不依赖其他测试的执行顺序或状态
- **可重复性**: 测试必须在任何环境下产生相同结果（禁止依赖外部服务的非 mock 测试）
- **快速反馈**: 单元测试套件执行时间不得超过 30 秒

### III. 用户体验一致性

用户体验是产品成功的关键，必须确保：

- **响应性**: 用户操作必须在 200ms 内有视觉反馈（加载状态、进度指示）
- **错误提示**: 错误信息必须对用户友好，提供明确的解决方案指引
- **一致性**: 相同类型的交互必须有相同的行为模式
- **可访问性**: 界面必须支持键盘导航；颜色对比度必须符合 WCAG 2.1 AA 标准
- **状态保持**: 用户操作不应意外丢失；表单数据必须有防丢失机制
- **离线友好**: 网络异常时必须有优雅的降级处理和明确的状态提示

### IV. 性能优先设计

性能是用户体验的基础，必须满足以下要求：

- **响应时间**: API 响应时间 P95 ≤ 200ms；P99 ≤ 500ms
- **资源限制**: 内存使用峰值不得超过配置阈值；CPU 使用率必须有合理上限
- **启动时间**: 应用冷启动时间不得超过 3 秒
- **并发能力**: 系统必须支持目标并发用户数（在设计文档中明确定义）
- **渐进加载**: 大数据集必须支持分页或虚拟滚动
- **缓存策略**: 重复计算必须有缓存机制；缓存必须有明确的失效策略

## 技术约束

### 技术栈要求

- **语言版本**: 必须使用 LTS（长期支持）版本或明确声明版本要求
- **依赖管理**: 所有依赖必须锁定版本；定期审查安全漏洞
- **配置管理**: 敏感配置禁止硬编码；必须支持环境变量覆盖

### 安全要求

- **输入验证**: 所有外部输入必须验证和清理
- **认证授权**: 敏感操作必须有认证；资源访问必须有授权检查
- **日志安全**: 日志禁止记录敏感信息（密码、密钥、个人身份信息）
- **传输安全**: 网络通信必须使用加密（TLS 1.2+）

## 开发工作流

### 代码审查

- 所有变更必须通过 Pull Request 提交
- PR 必须有至少一位非作者的审查者批准
- 审查者必须验证代码符合本宪法原则

### 持续集成

- 所有 PR 必须通过自动化测试
- 代码风格检查必须通过
- 安全扫描必须无高危漏洞

### 版本发布

- 遵循语义化版本控制（SemVer）
- 重大变更必须有迁移指南
- 发布前必须通过完整测试套件

## 治理规则

- 本宪法是项目开发的最高准则，所有决策必须与其一致
- 宪法修订需要文档化原因、获得批准、并提供迁移计划（如适用）
- 所有 PR 审查必须验证对宪法原则的遵从
- 复杂性增加必须有明确的合理性说明

**Version**: 1.0.0 | **Ratified**: 2024-12-17 | **Last Amended**: 2024-12-17
